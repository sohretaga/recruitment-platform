{% extends 'cp/base.html' %}
{% load static %}
{% load filters %}

{% block title %}Vacancy - Control Panel{% endblock %}

{% block stylesheets %}
<link rel="stylesheet" href="{% static 'cp/css/tables.css' %}">
{% endblock %}

{% block content %}

{% include 'cp/container.html' %}

<div class="table-container">
    <div id="data-filter">
        <div style="display: flex; margin-bottom: 10px;">
            <div class="chb-style">
                <span style="margin-right: 5px;">Language: </span>
                <div class="filter-chb">
                    {% languages as language_list %}
                    {% for language in language_list reversed %}
                        {% if forloop.first %}
                            <span title="{{language.name}}"><input type="checkbox" id="id-{{language.code}}" name="language" value="{{language.code}}"
                                    checked="checked"></span>
                            <label for="id-{{language.code}}"></label>
                        {% else %}
                            <span title="{{language.name}}"><input type="checkbox" id="id-{{language.code}}" name="language" value="{{language.code}}"></span>
                            <label for="id-{{language.code}}"></label>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <div class="caption" id="caption">Vacancy</div>
    <div id="table"></div>
</div>
{% endblock content %}

{% block scripts %}
<script src="{% static 'cp/js/command.js' %}"></script>
<script src="{% static 'cp/js/processes.js' %}"></script>
<script>
    var hot;
    const saveUrl = "{% url 'cp:vacancy_save' %}";
    const loadUrl = "{% url 'cp:vacancy_load' %}";
    const bmtTable = document.getElementById('table');
    const consoleText = 'Vacancy';
    const modelColumnMap = {
        'career_types':[5],
        'career_levels':[6],
        'locations':[7],
        'fte':[8],
        'employee_types':[13]

        /* We specify the names of the models from which data will be retrieved for updating as keys,
        and the IDs of the columns to be updated as values. This structure is used to clearly define
        which column will be updated from which model. */
    };

    $.ajaxSetup({
        beforeSend: function (xhr, settings) {
            xhr.setRequestHeader('X-CSRFToken', '{{ csrf_token }}');
            $('body').css('cursor', 'wait');
        },
        complete: function () {
            $('body').css('cursor', 'default');
        },
        error: function () {
            tableConsole.innerText = 'Failure when operation performed...';
        }
    });

    $(document).ready(function() {
        hot = new Handsontable(bmtTable, {
            rowHeaders: true,
            colHeaders: true,
            stretchH: 'all',
            startRows: 1,
            wordWrap: true,
            filters: true,
            data: [{id:''}],
            height: $(document).height() - 300,
            dropdownMenu:  ['filter_by_value', 'filter_action_bar'],
            licenseKey: 'non-commercial-and-evaluation',

            hiddenColumns: {
                columns: [0],
                indicators: false
            },

            columns: [
                {
                    title: 'id',
                    data: 'id',
                    readOnly: true
                },
                {
                    title: 'No',
                    data: 'no',
                    className: 'htCenter',
                    colWidths: 5
                },
                {
                    title: 'Organizatio',
                    data: 'organization',
                    colWidths: 100
                },
                {
                    title: 'Position Title',
                    data: 'name',
                    colWidths: 100
                },
                {
                    title: 'Definition',
                    data: 'definition',
                    colWidths: 100
                },
                {
                    title: 'Career Type',
                    data: 'career_type',
                    type: 'dropdown',
                    colWidths: 100
                },
                {
                    title: 'Career Level',
                    data: 'career_level',
                    type: 'dropdown',
                    colWidths: 100
                },
                {
                    title: 'Location',
                    data: 'location',
                    type: 'dropdown',
                    colWidths: 100
                },
                {
                    title: 'FTE',
                    data: 'fte',
                    type: 'dropdown',
                    colWidths: 100
                },
                {
                    title: 'Salary Minimum',
                    data: 'salary_minimum',
                    colWidths: 100
                },
                {
                    title: 'Salary Midpoint',
                    data: 'salary_midpoint',
                    colWidths: 100
                },
                {
                    title: 'Salary Maximum',
                    data: 'salary_maximum',
                    colWidths: 100
                },
                {
                    title: 'Job Title',
                    data: 'job_catalogue',
                    colWidths: 100
                },
                {
                    title: 'Employment Type',
                    data: 'employee_type',
                    type: 'dropdown',
                    colWidths: 100
                },
                {
                    title: 'Created Date',
                    data: 'created_date',
                    colWidths: 100
                }

            ],
        });
        

        loadData();
    })

</script>

{% endblock scripts %}