{% extends 'cp/base.html' %}
{% load static %}

{% block title %}Language Contents - Control Panel{% endblock %}

{% block stylesheets %}
<link rel="stylesheet" href="{% static 'cp/css/tables.css' %}">
{% endblock %}

{% block content %}

{% include 'cp/container.html' %}

<style>
    #add_row, #del_row {
        display: none;
    }
</style>

<div class="table-container">
    <div id="data-filter">
        <div style="display: flex; margin-bottom: 10px;">
            <div class="chb-style">
                <span style="margin-right: 5px;">Language: </span>
                <div class="filter-chb">
                    {% for language in languages %}
                        {% if forloop.first %}
                            <span title="{{language.name}}"><input type="checkbox" id="id-{{language.code}}" name="language" value="{{language.code}}"
                                    checked="checked"></span>
                            <label for="id-{{language.code}}"></label>
                        {% else %}
                            <span title="{{language.name}}"><input type="checkbox" id="id-{{language.code}}" name="language" value="{{language.code}}"></span>
                            <label for="id-{{language.code}}"></label>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <div class="caption" id="caption">Contents</div>
    <div id="table"></div>
</div>
{% endblock content %}

{% block scripts %}
<script src="{% static 'cp/js/command.js' %}"></script>
<script src="{% static 'cp/js/processes.js' %}"></script>
<script>
    const saveUrl = "{% url 'cp:contents_save' %}";
    const loadUrl = "{% url 'cp:contents_load' %}";
    const bmtTable = document.getElementById('table');
    const consoleText = 'Contents';
    var hot;
    const selectedLanguageCode = document.querySelector("input[name='language']:checked").value.toUpperCase();

    $(document).ready(function() {
        hot = new Handsontable(bmtTable, {
            rowHeaders: true,
            colHeaders: true,
            stretchH: 'all',
            startRows: 1,
            wordWrap: true,
            filters: true,
            data: [{id:''}],
            colWidths: [0, 400, 400, 50],
            height: $(document).height() - 350,
            dropdownMenu:  ['filter_by_value', 'filter_action_bar'],
            licenseKey: 'non-commercial-and-evaluation',

            hiddenColumns: {
                columns: [0],
                indicators: false
            },

            columns: [
                {
                    title: 'id',
                    data: 'id',
                    readOnly: true
                },
                {
                    title: 'EN',
                    data: 'text',
                    readOnly: true
                },
                {
                    title: '',
                    data: 'translation'
                },
                {
                    title: 'Delete',
                    data: 'delete',
                    type: 'checkbox',
                    className: 'htCenter'
                }
            ],
        });

        const changeSingleColumnHeader = (code) => {
            var currentHeaders = hot.getColHeader();
            currentHeaders[2] = code;
            hot.updateSettings({
                colHeaders: currentHeaders
            });
        };

        var languages = document.querySelectorAll("input[name='language']");
        languages.forEach((language) => {

            language.addEventListener('change', () => {
                let code = language.value.toUpperCase();
                changeSingleColumnHeader(code);
            });
        });

        changeSingleColumnHeader(selectedLanguageCode);
        loadData();

    })

</script>

{% endblock scripts %}